// @bun
var F=function(j,Q,Y,Z){var B=arguments.length,V=B<3?Q:Z===null?Z=Object.getOwnPropertyDescriptor(Q,Y):Z,G;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")V=Reflect.decorate(j,Q,Y,Z);else for(var N=j.length-1;N>=0;N--)if(G=j[N])V=(B<3?G(V):B>3?G(Q,Y,V):G(Q,Y))||V;return B>3&&V&&Object.defineProperty(Q,Y,V),V};var y=(j,Q)=>{if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(j,Q)};var{file:s0,inflateSync:t0,serve:r0,write:a0}=globalThis.Bun;import{Auth as e0}from"authored";import{config as j1}from"dotenv";function Q0(j){let Q;return class extends j{constructor(...Y){if(Q)return Q;super(...Y);Q=this}}}function Y0(j){return class extends j{constructor(...Q){super(...Q);let Y=new Map;return new Proxy(this,{get(Z,B){let V=`__${B}`;if(!Y.has(V)){let G=Z[B];if(_0(G))G=function(...N){let U=`${V}_${JSON.stringify(N)}`;if(!Y.has(U)){let $=Z[B].apply(Z,N);Y.set(U,$)}return Y.get(U)};Y.set(V,G)}return Y.get(V)},set(Z,B,V){let G=`__${B}`;return Y.set(G,V),!0}})}}}class T{static set p(j){if(Array.isArray(j))console.log(...j);else console.log(j)}}var C0=(j)=>Array.from({length:j},(Q,Y)=>Y),P0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",x0="abcdefghijklmnopqrstuvwxyz",A0=C0(10).join(""),L1=new RegExp(/(\d+)(\d*)/,"m"),_0=(j)=>typeof j==="function";var F0=(j)=>{return!isNaN(parseFloat(j))&&isFinite(j)};var Z0=(j)=>{return j instanceof Uint8Array||j instanceof ArrayBuffer||typeof j==="string"};var B0=(j)=>typeof j==="boolean",x=(j)=>typeof j==="string",V0=(j)=>Array.isArray(j);var y0=(j)=>{return Number.isInteger(Number(j))};var{keys:G0,entries:q,hasOwn:I1}=Object;var X=Object.assign,b=(j)=>{return Object.keys(j).length},d=(j,Q)=>{if(!j||!Q)return j;return j.replace(new RegExp(`^${Q}+|${Q}+$`,"g"),"")};var i=(j)=>JSON.stringify(j),N0=(j)=>{return JSON.parse(j)};var U0=(j,Q)=>{let[Y,Z]=Q.replace(/bytes=/,"").split("-").map((B,V)=>{let G=parseInt(B,10);return isNaN(G)?V===0?0:j-1:G});return[Y,Z,j]},W0=(j,Q)=>{return j.reduce((Y,Z,B)=>{return Y[Z]=Q[B],Y},{})},$0=(j,Q=!1)=>{if(F0(j))return[+j,y0(j)?"int":"float"];if(Q&&j.includes("."))return[j,"file"];if(j==="/")return[j,"-"];if(j.length===36&&j.match(/\-/g)?.length===4)return[j,"uuid"];return[j,"string"]};function S(j){let Q=j.startsWith("/")?j:"/"+j,Y=Q.match(/(?<=\/)[^/].*?(?=\/|$)/g)??["/"],[Z,B]=Y.reduce(([V,G],N)=>{if(N.includes("<")){let U=N.match(/(?<=<)[^/].*?(?=>|$)/g);if(U?.length){let[$,K]=U[0].split(":");if($&&K)V.push($),G.push(K)}}else V.push(N===">"?"/":N);return[V,G]},[[],[]]);if(Q.endsWith("/")&&Q.length>1)Z.push("/");return{parsed:Z,args:B}}class u{date;constructor(j){this.date=j?new Date(j):new Date}delta(j=null,Q=!1){let Y=u.delta(this.date.getTime(),j);return Q?new Date(Y):Y}timed(j){if(!j)return this.date;return[["year","FullYear"],["month","Month"],["day","Date"],["hour","Hours"],["minute","Minutes"],["second","Seconds"]].reduce((Y,[Z,B])=>{let V=j[Z];return V?new Date(Y[`set${B}`](Y[`get${B}`]()+V)):Y},new Date(this.date))}static delta(j,Q=null){return Q?Q-j:j-Date.now()}static get now(){return Date.now()}}var w=(j)=>{let Q=P0+x0;return Array.from({length:j},(Y,Z)=>Q+(Z?A0:"")).reduce((Y,Z)=>{return Y+=Z.charAt(Math.floor(Math.random()*Z.length))},"")};var{deflateSync:T0,gzipSync:S0}=globalThis.Bun;import{JWTInterface as u0}from"authored";class C{route;status;x_args;isFile;headers=new Headers({"Content-Type":"text/plain"});deflate;gzip;constructor({route:j,status:Q=404,headers:Y={}},Z){if(this.status=Q||404,this.route=j,this.x_args=Z||[],Y)this.header=Y;X(this,{status:Q}),this.isFile=!!j?.isFile,this.deflate=(B)=>{let V=T0(B);return this.header={"Content-Length":V.byteLength.toString(),"Content-Encoding":"deflate"},V},this.gzip=(B)=>{let V=S0(B);return this.header={"Content-Length":V.byteLength.toString(),"Content-Encoding":"gzip"},V}}set header(j){q(j).forEach(([Q,Y])=>{this.headers.set(Q,Y)})}set type(j){this.headers.set("Content-Type",j)}options(j,Q={}){return j+=", OPTIONS",new Response("",{status:204,headers:{Allow:j,"Access-Control-Allow-Methods":j,"Access-Control-Max-Age":"86400",...Q}})}}class M{static headstr="";headattr={};head;constructor(){this.head=(j)=>{q(j).forEach(([Q,Y])=>{if(Q=="title"||Q=="base")this.headattr[Q]=Y;else if(!(Q in this.headattr))this.headattr[Q]=Y;else this.headattr[Q].push(...Y)})}}}class K0{}class h extends M{lang="en";status;stream;__session;__jwt;headers={};set header(j){X(this.headers,j)}get header(){return this.headers}set type(j){this.header={"Content-Type":j}}get session(){if(!this.__session)this.__session=J.session.new;return this.__session}set session(j){this.__session=j}get jwt(){if(!this.__jwt)this.__jwt=J.jwt.new;return this.__jwt}set jwt(j){this.__jwt=j}get timedJWT(){return J.jwtInt.jwt()}setCookie({key:j,val:Q,path:Y="/",days:Z=31,httpOnly:B=!1}){let V=f0(j,Q,{expires:new u().timed({day:Z}),path:Y,httpOnly:B,sameSite:"Strict"});this.header={"Set-Cookie":V}}deleteCookie(j){this.setCookie({key:j,val:"",days:0})}}var f0=(j,Q="",{maxAge:Y,expires:Z,path:B,domain:V,secure:G,httpOnly:N,sameSite:U})=>{if(Y instanceof Date)Y=Y.getSeconds();if(Z instanceof Date)Z=Z.toUTCString();else if(Z===0)Z=new Date().toUTCString();return[["Domain",V],["Expires",Z],["Max-Age",Y],["Secure",G],["HttpOnly",N],["Path",B],["SameSite",U]].reduce((K,[P,z])=>{if(z!==void 0)K.push(`${P}=${z}`);return K},[`${j}=${Q}`]).join("; ")};class o{ctrl;intervalID=[];constructor(j){this.ctrl=j}push(j,Q=2000){if(this.ctrl){let Y=setInterval(()=>{let{id:Z,retry:B,data:V,event:G,end:N}=j();if(this.ctrl){let U=N?"end":V;if(B){let $=B>2000?B:2000;this.ctrl.enqueue(`retry: ${$}\\n`)}if(this.ctrl.enqueue(`id: ${Z}\\n`),G&&this.ctrl.enqueue(`event: ${G}\\n`),typeof U=="object")this.ctrl.enqueue("data: "+JSON.stringify(U)+"\\n\\\n");else this.ctrl.enqueue("data: "+JSON.stringify({message:U})+"\\n\\n");N&&this.close()}},Q>1000?Q:1000);this.intervalID.push(Y)}}close(){if(this.intervalID.length)this.intervalID.forEach((j)=>{clearInterval(j)}),this.intervalID=[];this.ctrl?.close()}}class f{session;jwt;jwtInt;constructor(){this.jwtInt=new u0}init(j){this.session=j.session,this.jwt=j.jwt}}f=F([Q0,y("design:paramtypes",[])],f);var J=new f;var{file:J0,gzipSync:g0}=globalThis.Bun;class p{path;proto;config;isWSS;isFile;options;bytes;parsed=[];args=[];fileType="text/plain";constructor(j,Q,Y={},Z=!1,B=!1,V=""){this.path=j;this.proto=Q;this.config=Y;this.isWSS=Z;this.isFile=B;this.options=V;if(X(this,S(j)),B)this.fileType=J0(j).type}async loadbytes(j){if(this.config.preload)try{let Q=await J0(j+this.path).bytes();this.bytes=g0(Q)}catch{throw`error: can't preload ${this.path}. File not found.`}return this}}var{setPath:g,getPath:L0,setFolder:I0}=function(){let j=["string","int","float","file","uuid"],Q=["GET","POST","PUT","DELETE","OPTIONS"],Y=new Map,Z=new Map,B=new Map,V=new Map,G=(W,L)=>{return W?Z:L?B:Y},N=(W)=>{let L=W.slice().pop();return L?$0(L,!0).pop()==="file":!1},U=(W)=>{return Q.filter((L)=>W[L.toLowerCase()]).join(", ")},$=(W)=>{let{path:L,parsed:E,isFile:O,isWSS:D}=W,I=G(D,O),H=JSON.stringify(E);if(!I.get(H))I.set(H,W);else if(!O)throw`path: ${L} already declared.`};function K(W,L={}){W=d(W,"."),W=d(W,"/"),V.set(W,L)}function P({isFile:W,parsed:L,path:E}){if(!W)return new C({});let O=L.slice(0,-1).join("/");for(let[D,I]of V.entries())if(O.startsWith(D))return new C({route:new p(`.${E}`,null,{requireSession:!!I?.requireSession},!1,W),status:200});return new C({})}function z(W,L,E,O,D){return(I)=>{let H=new p(W,I.prototype,L,E,O,U(I.prototype));if(D)H.loadbytes(D);return $(H),I}}function R0({parsed:W,isWSS:L=!1,path:E}){let O=N(W),D=[],I=G(L,O),H=I.get(i(W));if(!H){let _=[];for(let w0 of I.keys()){let e=N0(w0),j0=e.length;if(W.length===j0)for(let R=0;R<j0;R++){let k=W[R],c=e[R];if(c===k)_[R]=k;else if(j.includes(c))_[R]=c,D.push(k)}}H=I.get(i(_))}if(H)return new C({route:H,status:200},D);else return P({isFile:O,parsed:W,path:E})}return{setPath:z,getPath:R0,setFolder:K}}();var l=new Map;class s{request;ws;path;id;broadcasting=!1;max=0;constructor(j){this.request=j;this.path=j.path,this.id=w(10)}async open(){}async message(j){}async close(j,Q){}set send(j){if(j)if(this.broadcasting)this.ws.publish(this.path,j);else this.ws.send(j)}get role(){let j=l.get(this.path);if(j&&this.id in j)return j[this.id].role}get session(){if(!this.__session)this.__session=J.session.new;return this.__session}set session(j){this.__session=j}get jwt(){if(!this.__jwt)this.__jwt=J.jwt.new;return this.__jwt}set jwt(j){this.__jwt=j}get timedJWT(){return J.jwtInt.jwt()}}class H0{async open(){}async message(j){}async close(j,Q){}max=0;broadcasting=!1}var O0=(j)=>{if(!l.get(j))l.set(j,{});return l.get(j)??{}},D0={async open(j){let Q=j.data.wclass,{z_args:Y,client:Z}=j.data;if(Q){Q.ws=j;let B=Q.id,V=b(Z);if(!(B in Z)){let G=V?"joiner":"maker";Z[B]={role:G}}if(typeof Q.init=="function")await Q.init(Y);if(Q.broadcasting)Q.ws.subscribe(Q.path);await Q.open()}else j.close()},async message(j,Q){let Y=j.data.wclass;if(Y)await Y.message(Q)},async close(j,Q,Y){let Z=j.data.wclass,B=j.data.client;if(Z){if(await Z.close(Q,Y),Z.broadcasting)Z.ws.unsubscribe(Z.path);let V=Z.id;if(delete B[V],b(B)===1)G0(B).forEach((G,N)=>{B[G].role="maker"})}}};var{file:v0}=globalThis.Bun;import{ServerSide as m0}from"authored";var{Server:l0}=globalThis.Bun;class A{req;server;formData;url;method;__cookies=new Map;constructor(j,Q){this.req=j;this.server=Q;this.url=new URL(j.url),this.method=this.req.method.toLowerCase()}async form(){if(this.isForm){if(!this.formData)this.formData=await this.req.formData();return this.formData}return new FormData}async authgroup(){let{cookies:j,auth:Q}=this,Y=j.get("session")??"",Z=Q??"",B="",V=this.isForm?await this.form():void 0;if(V){let G=V.get("refresh_token");B=G?G.toString():""}return{sid:Y,jwtv:Z,refreshjwt:B}}upgradeConnection(j={}){return!!this.server?.upgrade(this.req,j)}get auth(){let j=this.headers.get("authorization");if(j){let[Q,Y]=j.split(" ",2);if(Q.trim()=="Bearer")return Y.trim()}}get accept(){return this.headers.get("accept")}get contentType(){return this.headers.get("content-type")}get cookies(){if(!this.__cookies.size){let j=this.headers.get("cookie");if(j){let Q=j.split(";").reduce((Y,Z)=>{let[B,V]=Z.trim().split(/=(.*)/s);return Y.push([B,V]),Y},[]);this.__cookies=new Map(Q)}}return this.__cookies}get headers(){return this.req.headers??new Headers}get ip(){return this.server?.requestIP(this.req)}get isForm(){let j=this.contentType;return j?j.indexOf("multipart/form-data")>=0||j.indexOf("x-www-form-urlencoded")>=0:!1}get isEventStream(){return this.accept?.includes("text/event-stream")}get path(){return this.url.pathname}get parsed(){let{parsed:j}=S(this.path);return j}get searchParams(){return this.url.searchParams}get range(){return this.headers.get("range")??void 0}get isWSS(){return!!this.headers.get("upgrade")}get upgrade(){return this.headers.get("upgrade")}get request(){return this.req}get signal(){return this.req.signal}}A=F([Y0,y("design:paramtypes",[typeof Request==="undefined"?Object:Request,typeof l0==="undefined"?Object:l0])],A);class m{app;data;constructor(j,Q={}){this.app=j;this.data=Q}_head(j){if(!j.startsWith("."))j="."+j;return`<script type="module">import x from "${j}";x.ctx(${JSON.stringify(this.data)});</script>`}async render(j,Q){if(x(this.app)){let Y=this._head(this.app);return v("",j+Y,Q)}else if("ssr"in this.app){let Y=await this.app.ssr(this.data);return v("",j+Y.script,Q,Y.body)}return v("",j,Q)}}class n{apt;method;isFile;isEStream;isWSS=!1;z_args={};constructor(j,Q,Y="./"){this.apt=Y;let Z=new A(j,Q),{parsed:B,method:V,path:G,isWSS:N,isEventStream:U}=Z,$=L0({parsed:B,isWSS:N,path:G});this.isEStream=!!U,this.isWSS=N,this.isFile=$.isFile,this.method=V;let K=i0(Z);Object.defineProperties(this,{req:{get:function(){return Z}},_resp:{get:function(){return K}},maker:{get:function(){return $}}})}push(j,Q){let{status:Y,headers:Z}=this.maker;return Q??=Y,new Response(j,{status:Q,headers:Z})}async processMethod(j){let{maker:Q,method:Y,_resp:Z}=this,B=await j.call(Z,this.z_args);if(typeof B==="object"&&"error"in B){Q.status=B.error;return}let{header:V,status:G,headattr:N,lang:U,__session:$}=Z;if(b(V))Q.header=V;if(G)Q.status=G;if($&&await h0($,Q.headers),!B){Q.status=G??204;return}if(B instanceof Response)return Q.status=B.status,Q.header=B.headers.toJSON(),await B.arrayBuffer();if(Y==="post"&&B instanceof m0)return n0.call(this,B);if(typeof B==="object"&&!(B instanceof m))return Q.type="application/json",JSON.stringify(B);Q.type="text/html";let K=[M.headstr,...t(N)].join("");if(B instanceof m)return await B.render(K,U);return v(String(B),K,U)}async response(){let{maker:j,isWSS:Q,isFile:Y,isEStream:Z,method:B,_resp:V}=this,G=j.route;if(!G)return this.push(j.deflate(""));if(this.z_args=W0(G.args??[],j.x_args),await X0(V,this.z_args,await this.req.authgroup()),b0(!!G.config.requireSession,this.z_args))return j.status=401,this.push();if(Y)return this.push(await d0.call(this,G));let{proto:N,isWSS:U}=G;if(Q&&U){let K=await c0.call(this,G);return this.push(j.deflate(K??""))}let $="eventStream";if(N?.[$]&&Z){let K=await k0.call(this,N[$]);return this.push(K)}if(N?.[B]){let K=await this.processMethod(N[B]);return this.push(j.deflate(K??""))}return this.push(j.deflate(""))}}async function n0(j){let Q=this.maker,{jwtv:Y,refreshjwt:Z}=await this.req.authgroup(),B={},V=(N)=>{return Q.status=403,{error:N}},G=async(N)=>{let U=J.jwtInt.save(N);return N.access_token=U,await J.jwt.saveSession(N,Q.headers),{access_token:U,refresh_token:N.sid,status:"ok"}};if(Z){let N=await J.jwt.openSession(Z),U=N.data.access_token;if(Y!==U)B=V("tokens don't match.");else if(!J.jwtInt.verify(U,{days:5}))await J.jwt.saveSession(N,void 0,!0),B=V("expired refresh_token");else B=await G(N)}else if(!Y&&j.modified)B=await G(j);else Q.status=204;return Q.type="application/json",JSON.stringify(B)}async function X0(j,Q,Y){let Z={},{sid:B,jwtv:V,refreshjwt:G}=Y;if(B){if(j.session=await J.session.openSession(B),!j.session.new)Z.session=!0}if(V){if(j.jwt=J.jwtInt.open(V,{hours:6}),!j.jwt.new)Z.jwt=!0;if(G){if(!(await J.jwt.openSession(G)).new)Z.jwt_refresh=!0}}if(b(Z))X(Q,Z)}async function k0(j){let{req:Q,z_args:Y,_resp:Z}=this,B=this.maker,V=new ReadableStream({async start(N){Z.stream=new o(N),await j.call(Z,Y),Q.signal.addEventListener("abort",()=>{if(Z.stream?.close(),Z.stream?.intervalID.length)N.close()})}});B.header={"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"};let G=await j.call(Z,Y);if(typeof G==="object"&&"error"in G)return B.status=G.error,"";return V}async function c0(j){let{req:Q,z_args:Y}=this,Z=new s(Q);if(await X0(Z,Y,await Q.authgroup()),b0(!!j.config.requireSession,Y))return this.maker.status=401,"";let{broadcast:B,maxClient:V}=j.config,G=Z.path,N=O0(G),U=b(N);if(Z.broadcasting=!!B,Z.max=V??0,V&&U>=V)return"upgrade error";let{open:$,message:K,close:P,init:z}=j.proto;return Z.open=$,Z.message=K,Z.close=P,Z.init=z,this.req.upgradeConnection({data:{wclass:Z,z_args:Y,client:N}}),"upgrade error"}async function d0(j){let Q=this.req.range,Y=this.maker,{path:Z,bytes:B,fileType:V}=j;if(B)return q0(B,B.byteLength,V,Y,Q);let G=v0(this.apt+Z);try{let U=V.startsWith("video/")?G:await G.bytes();return q0(U,G.size,V,Y,Q)}catch{return Y.status=404,`${Z} file not found.`}}var q0=(j,Q,Y,Z,B)=>{if(Z.type=Y,!B)return Z.header={"Cache-Control":"max-age=86400, must-revalidate"},Z0(j)?Z.gzip(j):j;let[V,G,N]=U0(Q,B);return Z.header={"Content-Range":`bytes ${V}-${G}/${N}`,"Content-Length":Q.toString()},Z.status=206,j.slice(V,G+1)},t=(j)=>{if(!j)return[];return q(j).reduce((Q,[Y,Z])=>{if(x(Z))return Q.push(`<${Y}>${Z}</${Y}>`),Q;if(!V0(Z))return Q;let B=Z.map((V)=>{if(Y==="script"){let G={...V},N="";if("importmap"in G)G.type="importmap",N=JSON.stringify(G.importmap),delete G.importmap;else if("body"in G)N=G.body,delete G.body;return`<${Y}${E0(G)}>${N}</${Y}>`}return`<${Y}${E0(V)}>`});return Q.push(...B),Q},[])},E0=(j)=>{return q(j).reduce((Q,[Y,Z])=>{return Q.push(B0(Z)?Y:`${Y}="${Z}"`),Q},[""]).join(" ")},b0=(j,Q)=>{return j&&!(("session"in Q)||("jwt"in Q))},v=(j,Q,Y,Z)=>{return[`<!DOCTYPE html><html lang="${Y}">`,`<head>${Q}</head>`,Z?Z:`<body id="${w(5)}">${j}</body>`,"</html>"].join("")},i0=(j)=>{let Q=new h;return Object.defineProperties(Q,{request:{get:function(){return j}}}),Q},h0=async(j,Q)=>{await J.session.saveSession(j,Q)};import{readdirSync as Q1,rmSync as Y1,statSync as Z1,unlinkSync as B1,watch as V1}from"fs";import{mkdirSync as o0,writeFileSync as p0}from"fs";var M0=(j,Q="")=>{try{return p0(j,Q,{flag:"wx"}),!0}catch(Y){return!1}},r=(j)=>{return o0(j,{recursive:!0}),!0};import G1 from"path";class N1 extends M{dir;apt;serve;constructor(j="./",Q={}){super();this.dir=j;let Y=this.dir+"/.private",{envPath:Z,appDir:B,session:V}=Q;if(!Z)r(Y),M0(Y+"/.env",`SECRET_KEY="${w(20)}"`);this.apt=j+"/"+(B??"app")+"/",j1({path:(Z?Z:Y)+"/.env"});let G=V??new e0({dir:this.dir});J.init(G),this.serve=async(N,U)=>await U1.call(this,N,U)}route(j){return g(j,{},!1,!1)}wss(j,Q={}){return g(j,Q,!0,!1)}redirect(j,Q={}){return new Response("",{status:302,headers:{...Q,Location:j}})}folders(...j){j.forEach((Q)=>I0(...z0(Q)))}files(...j){j.forEach((Q)=>{let[Y,Z]=z0(Q),B=Y.replace(/^\.+/,""),V=B.startsWith("/")?B:"/"+B;g(V,Z,!1,!0,Z.preload?this.apt:void 0)})}session(...j){return a(j[0],j[2],"session")}jwt(...j){return a(j[0],j[2],"jwt")}jwt_refresh(...j){return a(j[0],j[2],"jwt_refresh")}}async function U1(j,Q={}){let{path:Y,hostname:Z,method:B,port:V}=j;if(V??=3000,M.headstr=t(this.headattr).join(""),Y)await $1({url:`http://${Z??"127.0.0.1"}:${V}${Y}`,method:B??"GET"},this.apt);else r0({port:j.port,tls:W1(this.dir),fetch:async(G,N)=>{return await new n(G,N,this.apt).response()},websocket:{sendPings:!0,perMessageDeflate:!0,...Q,...D0}})}var W1=(j)=>{return q(process.env).filter(([Q])=>Q.startsWith("TLS_")).reduce((Q,[Y,Z])=>{if(Z){let B=Y.replace("TLS_","").toLowerCase();Q[B]=s0(j+"/"+Z)}return Q},{})},z0=(j)=>{let Q=x(j);return[Q?j:j[0],Q?{}:j[1]]},a=(j,Q,Y)=>{let Z=Q.value;return Q.value=async function(B={}){if(Y in B&&B.session)return Z.call(j,B);return{error:401}},Q},$1=async(j,Q)=>{let Y=await new n(j,void 0,Q).response(),Z=t0(await Y.arrayBuffer());Z.byteLength&&a0(Q+"index.html",Z)};class K1{dir;files;out;target;define;exclude=[];clearing=!1;constructor({dir:j,files:Q,out:Y,target:Z="browser",define:B={}}){this.dir=j,this.files=Q.map((V)=>j+"/"+V),this.out=Y,r(Y),this.target=Z,this.define=B??{}}clear(j={exclude:[]}){this.exclude=j.exclude.length?j.exclude:this.exclude,this.clearing=!0;let Q=(Y)=>{let Z=Q1(Y);if(Z.length==0){Y1(Y,{recursive:!0});return}Z.forEach((B)=>{if(B.startsWith(".")||this.exclude.includes(B))return;let V=G1.join(Y,B);if(Z1(V).isDirectory())Q(V);else B1(V)})};return Q(this.out),this}build(){return this.files.length&&Bun.build({entrypoints:this.files,outdir:this.out,splitting:!0,minify:{identifiers:!0,whitespace:!0,syntax:!0},target:this.target??"browser",naming:{chunk:"[name]-[hash].[ext]",entry:"[dir]/[name].[ext]",asset:"[name]-[hash].[ext]"},define:{...this.define},experimentalCss:!0}).then((j)=>{if(j.success)T.p="success";else T.p=j.logs}),this}watch(j){let Q=j?this.dir+j:this.dir,Y=V1(Q,{recursive:!0},async(Z,B)=>{if(B&&B.endsWith("tsx"))this.clearing&&this.clear(),this.build()});process.on("SIGINT",()=>{console.log(`
watcher closed...`),Y.close(),process.exit(0)})}}export{H0 as websocket,K0 as response,m as Render,N1 as Raboot,K1 as Builder,T as $$};
